<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ProfileMojo.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jsxm-maven-plugin</a> &gt; <a href="index.html" class="el_package">org.jsxm.maven.plugin.mojo</a> &gt; <span class="el_source">ProfileMojo.java</span></div><h1>ProfileMojo.java</h1><pre class="source lang-java linenums">/**
 * JSXM Maven PLugin CONFIDENTIAL
 * 
 *  __________________
 * 
 * Unpublished Copyright Â© 2012-2013 Konstantinos Margaritis, 
 * All Rights Reserved.
 * 
 * NOTICE:  All information contained herein is, and remains the property of Konstantinos Margaritis . 
 *
 * The intellectual and technical concepts contained herein are proprietary to the owner
 * Konstantinos Margaritis and may be covered by U.S and Foreign Patents, patents in process, 
 * and are protected by trade secret or copyright law. Dissemination of this information or 
 * reproduction of this material is strictly forbidden unless prior written permission is
 * obtained from Konstantinos Margaritis. Access to the source code contained herein is hereby 
 * forbidden to anyone except the owner.Confidentiality and Non-disclosure agreements 
 * explicitly covering such access.
 *
 * The copyright notice above does not evidence any actual or intended publication 
 * or disclosure  of  this source code, which includes information that is confidential 
 * and/or proprietary, and is a trade secret, of  Konstantinos Margaritis. ANY REPRODUCTION, 
 * MODIFICATION, DISTRIBUTION, PUBLIC  PERFORMANCE, OR PUBLIC DISPLAY OF OR THROUGH USE  OF 
 * THIS  SOURCE CODE  WITHOUT  THE EXPRESS WRITTEN CONSENT OF Konstantinos Margaritis IS STRICTLY PROHIBITED, 
 * AND IN VIOLATION OF APPLICABLE LAWS AND INTERNATIONAL TREATIES.  THE RECEIPT OR POSSESSION OF  
 * THIS SOURCE CODE AND/OR RELATED INFORMATION DOES NOT CONVEY OR IMPLY ANY RIGHTS  
 * TO REPRODUCE, DISCLOSE OR DISTRIBUTE ITS CONTENTS, OR TO MANUFACTURE, USE, OR SELL 
 * ANYTHING THAT IT  MAY DESCRIBE, IN WHOLE OR IN PART.  
 * 
 */
package org.jsxm.maven.plugin.mojo;

import java.io.File;
import java.io.IOException;
import java.util.Properties;

import org.apache.commons.io.FileUtils;
import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugin.MojoFailureException;
import org.jsxm.jsxmcore.util.Various;
import org.jsxm.maven.plugin.jsxmtool.JSXMFacade;
import org.jsxm.maven.plugin.jsxmtool.utilities.JSXMUtils;
import org.slf4j.LoggerFactory;

import ch.qos.logback.classic.Logger;

/**
 * @author Konstantinos Margaritis
 *
 */

/**
 * Goal that profiles all the specifications of a project
 * using different implementations of thread pools.
 * The goal can be very CPU and MEMORY intensive 
 * depending on the configuration.
 * 
 * The current goal is dependent in the executions variable.
 * The goal runs each phase of the JSXM tool with 4 different settings.
 * The phases are validate, compile, generate, transform.
 * The setting are:
 * 
 * &lt;ul&gt;
 * &lt;i&gt;newFixedThreadPool with all the available processors,
 * &lt;i&gt;newCachedThreadPool,
 * &lt;i&gt;newSingleThreadExecutor,
 * &lt;i&gt;newFixedThreadPool with one thread.
 * &lt;ul&gt;
 * 
 * Executions should be used with caution due to the fact that too many executions
 * in a very intensive specification can cause huge amounts of IO, resulting in 
 * huge log files and make your system unresponsive.
 * 
 * An acceptable amount of executions is 4 which is the default number.
 * 
 * @since Version 1.3
 * @goal profile
 * @phase compile
 */
<span class="fc" id="L80">public class ProfileMojo extends AbstractMojo {</span>
    
<span class="fc" id="L82">    private final String fileSeparator = System.getProperty(&quot;file.separator&quot;);</span>
<span class="fc" id="L83">    private final Logger logger = (Logger) LoggerFactory.getLogger(this.getClass());</span>
    
    /**
     * Sets the maven local repository. By default the value is the default
     * value set by maven .
     * 
     * @parameter default-value=&quot;${settings.localRepository}&quot;
     * @required
     */
    private String m2Home;
    
    /**
     * Sets the temp directory that temporary files from jsxm are going to be
     * saved. The default value is inside the target directory of a maven
     * project.
     * 
     * @parameter default-value=&quot;${project.build.directory}&quot;
     * @required
     */
    private String tempTarget;
    
    /**
     * Sets the implementation directory of the maven project. The default value
     * is the src/main/java of the maven project.
     * 
     * @parameter default-value=&quot;${basedir}/src/main/java/&quot;
     * @required
     */
    private File javaDirectory;
    
    /**
     * Sets the mode of the maven project. Verbose and overwrite are the
     * available options. By default the mode is set to overwrite.
     * 
     * @parameter default-value=&quot;overwrite&quot;
     * @required
     */
    private String mode;
    
    /**
     * Sets the k value that is going to be used in the generation of tests. The
     * default valee is 2.
     * 
     * @parameter default-value=&quot;2&quot;
     * @required
     */
    private String kInput;
    
    /**
     * JSXM imports for the SXM.java. The default imports are import
     * org.jsxm.jsxmcore.core.*;\n import org.jsxm.jsxmcore.types.*;\n
     * 
     * @parameter default-value=
     *            &quot;import org.jsxm.jsxmcore.core.*;\nimport org.jsxm.jsxmcore.types.*;\nimport org.jsxm.jsxmcore.exceptions.*;\n&quot;
     * @required
     */
    private String jsxmSxmImports;
    
    /**
     * JSXM imports for the SXM_base.java. The default imports are import
     * org.jsxm.jsxmcore.core.*;\n import org.jsxm.jsxmcore.exceptions.*;\n\n
     * 
     * 
     * @parameter default-value=
     *            &quot;import org.jsxm.jsxmcore.core.*;\nimport org.jsxm.jsxmcore.exceptions.*;\n\n&quot;
     * @required
     */
    private String jsxmSxmBaseImports;
    
    /**
     * The type that the SXM_base.java is inheriting. The default value is SXM
     * 
     * @parameter default-value=&quot;SXM&quot;
     * @required
     */
    private String jsxmSxmBaseInheritance;
    
    /**
     * List in order to provide different k for each specification. For example
     * if a specification A needs k=2 and specification B k=4 kList must
     * contain, &amp;lt;param&amp;gt;&amp;lt;/param&amp;gt;
     * 
     * 
     * The kList is a list of properties that allows the execution of examples
     * with a different k than the default. In case an example contains more
     * than one specification, then there is the possibility to need a different
     * k value for some of the specifications but at the same time not changing
     * the general k value. In order to use this tag the following configuration
     * must be followed. 
     *  &amp;lt;kList&amp;gt;
     *      &amp;lt;property&amp;gt;
     *          &amp;lt;name&amp;gt;&amp;lt;/name&amp;gt;
     *          &amp;lt;value&amp;gt;&amp;lt;/value&amp;gt;
     *      &amp;lt;/property&amp;gt;
     *  &amp;lt;/kList&amp;gt; 
     * Consider the example Book_Borrower which contains 3
     * specifications. \The specifications Book, Borrower and Library will use
     * the k value 2 in case none configuration is specified. On the other hand,
     * if you would like to execute the Library specification with a k=4, and
     * Book with k=5 then you should consider the following. 
     *  &amp;lt;kList&amp;gt;
     *      &amp;lt;property&amp;gt;
     *          &amp;lt;name&amp;gtLibrary&amp;lt;/name&amp;gt;
     *          &amp;lt;value&amp;gt4&amp;lt;/value&gt;&amp;gt;
     *      &amp;lt;/property&amp;gt; 
     *      &amp;lt;property&amp;gt;
     *          &amp;lt;name&amp;gt;Book&amp;lt;/name&amp;gt; 
     *          &amp;lt;value&amp;gt5&amp;lt;/value&amp;gt; 
     *      &amp;lt;/property&amp;gt; 
     *  &amp;lt;/kList&amp;gt; The above setting
     * will override the default k and will use the specified instead. The
     * Borrower specification will use k=2. The name tag must be identical with
     * the specification name.
     * 
     * @parameter
     */
    private Properties kList;
    
    /**
     * Sets the namespace used by the jsxm core and by maven-jsxm-plug in. The
     * default namespace is http://www.jsxm.org/schema. The namespace must be
     * the same as the namespaces used in the xsd schemas (specification, sets,
     * definitions). The above namespace is used for the validation, creation
     * and all the necessary operations needed regarding the xml files.
     * 
     * @parameter default-value=&quot;http://www.jsxm.org/schema&quot;
     * @required
     */
<span class="fc" id="L211">    private String nameSpace = &quot;&quot;;</span>
    
    /**
     * Sets the directory for all the jsxm specifications. The default value is
     * the spec directory under src--&gt;src/spec.
     * 
     * @parameter default-value=&quot;${basedir}/src/spec/&quot;
     * @required
     */
<span class="fc" id="L220">    private String jsxmSpecRootDir = &quot;&quot;;</span>
    
    /**
     * Sets the test directory of the maven project. The default value is the
     * src/test/java of the maven project.
     * 
     * @parameter default-value=&quot;${basedir}/src/test/java/&quot;
     * @required
     */
<span class="fc" id="L229">    private String testDirectory = &quot;&quot;;</span>
    
    /**
     * Sets the console LOGGER level.
     * 
     * @parameter default-value=&quot;INFO&quot;
     * @required
     */
    private String consoleLoggerLevel;
    
    
    /**
     * Sets the specName.html file logger level.
     * 
     * @parameter default-value=&quot;INFO&quot;
     * @required
     */
    private String htmlFileLoggerLevel;
    
    
    /**
     * Sets the specName.txt file logger level.
     * 
     * @parameter default-value=&quot;INFO&quot;
     * @required
     */
    private String txtFileLoggerLevel;
    
    /**
     * Executions should be used with caution due to the fact that too many executions
     *  in a very intensive specification can cause huge amounts of IO, resulting in 
     *  huge log files and make your system unresponsive.
     * 
     * @parameter default-value=&quot;4&quot;
     * @required
     */
    private int executions;
    
    /**
     * The name of the project.
     * 
     * @parameter default-value=&quot;${project.name}&quot;
     * @required
     */
    private String projectName;
    
    /**
     * Boolean for creating a pdf report of the log, system configuration and
     * user settings.
     * 
     * @parameter default-value=&quot;true&quot;
     * @required
     */
    private boolean pdfReportFlag;
    
    /** 
     * By setting ansiSupport to true the application is using ansi
     * output which produces colorful messages in the console.
     * This does not affect the output files. 
     * 
     * @parameter default-value=&quot;false&quot;
     * @required
     */
    private boolean ansiSupport;
    
    /** 
     * Overrides the threads allocated by the application
     * with the number provided. The default
     * number of threads is the logical cores of the CPU.
     * 
     * @parameter
     * @since 1.4.10
     */
    private int threads;
            
    private static final String CACHED_THREAD_POOL=&quot;cachedThreadPool&quot;;
    private static final String FIXED_THREAD_POOL=&quot;fixedThreadPool&quot;;
    private static final String SINGLE_FIXED_THREAD_POOL=&quot;singleFixedThreadPool&quot;;
    private static final String SINGLE_THREAD_EXECUTOR=&quot;singleThreadExecutor&quot;;
    
<span class="fc" id="L309">    private int indent = 0;</span>
    
    private static final int TOTAL_PHASES=4;
    private static final int MULTI_FIXED_POOL=0;
    private static final int MULTI_CACHED_POOL=1;
    private static final int SINGLE_SINGLE_POOL=2;
    private static final int SINGLE_FIXED_POOL=3;
    
    /* (non-Javadoc)
     * @see org.apache.maven.plugin.Mojo#execute()
     */
    @Override
    public void execute() throws MojoExecutionException, MojoFailureException {
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">        if (executions &gt; 1) {</span>
<span class="fc" id="L323">            long averages[] = new long[TOTAL_PHASES];</span>
<span class="fc" id="L324">            long compileAverages[] = new long[TOTAL_PHASES];</span>
<span class="fc" id="L325">            long generateAverages[] = new long[TOTAL_PHASES];</span>
<span class="fc" id="L326">            long transformAverages[] = new long[TOTAL_PHASES];</span>
            try {
<span class="fc" id="L328">                averages[MULTI_FIXED_POOL] = profileValidation(FIXED_THREAD_POOL);</span>
<span class="fc" id="L329">                averages[MULTI_CACHED_POOL] = profileValidation(CACHED_THREAD_POOL);</span>
<span class="fc" id="L330">                averages[SINGLE_SINGLE_POOL] = profileValidation(SINGLE_THREAD_EXECUTOR);</span>
<span class="fc" id="L331">                averages[SINGLE_FIXED_POOL] = profileValidation(SINGLE_FIXED_THREAD_POOL);</span>
                
<span class="fc" id="L333">                compileAverages[MULTI_FIXED_POOL] = profileCompilation(FIXED_THREAD_POOL);</span>
<span class="fc" id="L334">                compileAverages[MULTI_CACHED_POOL] = profileCompilation(CACHED_THREAD_POOL);</span>
<span class="fc" id="L335">                compileAverages[SINGLE_SINGLE_POOL] = profileCompilation(SINGLE_THREAD_EXECUTOR);</span>
<span class="fc" id="L336">                compileAverages[SINGLE_FIXED_POOL] = profileCompilation(SINGLE_FIXED_THREAD_POOL);</span>
                
<span class="fc" id="L338">                generateAverages[MULTI_FIXED_POOL] = profileGeneration(FIXED_THREAD_POOL);</span>
<span class="fc" id="L339">                generateAverages[MULTI_CACHED_POOL] = profileGeneration(CACHED_THREAD_POOL);</span>
<span class="fc" id="L340">                generateAverages[SINGLE_SINGLE_POOL] = profileGeneration(SINGLE_THREAD_EXECUTOR);</span>
<span class="fc" id="L341">                generateAverages[SINGLE_FIXED_POOL] = profileGeneration(SINGLE_FIXED_THREAD_POOL);</span>
                
<span class="fc" id="L343">                transformAverages[MULTI_FIXED_POOL] = profileThransformation(FIXED_THREAD_POOL);</span>
<span class="fc" id="L344">                transformAverages[MULTI_CACHED_POOL] = profileThransformation(CACHED_THREAD_POOL);</span>
<span class="fc" id="L345">                transformAverages[SINGLE_SINGLE_POOL] = profileThransformation(SINGLE_THREAD_EXECUTOR);</span>
<span class="fc" id="L346">                transformAverages[SINGLE_FIXED_POOL] = profileThransformation(SINGLE_FIXED_THREAD_POOL);</span>
<span class="nc" id="L347">            } catch (IOException e) {</span>
<span class="nc" id="L348">                logger.error(&quot;IOException&quot;, e);</span>
<span class="fc" id="L349">            }</span>
            
<span class="fc" id="L351">            StringBuilder profilerResults = new StringBuilder();</span>
            
<span class="fc" id="L353">            write(&quot;\n\n###################################################&quot;, profilerResults);</span>
<span class="fc" id="L354">            write(&quot;\n#########VALIDATION phase profiler results#########&quot;, profilerResults);</span>
<span class="fc" id="L355">            writeAverages(averages, profilerResults);</span>
<span class="fc" id="L356">            write(&quot;\n###################################################&quot;, profilerResults);</span>
            
<span class="fc" id="L358">            write(&quot;\n\n###################################################&quot;, profilerResults);</span>
<span class="fc" id="L359">            write(&quot;\n#########COMPILATION phase profiler results########&quot;, profilerResults);</span>
<span class="fc" id="L360">            writeAverages(compileAverages, profilerResults);</span>
<span class="fc" id="L361">            write(&quot;\n###################################################&quot;, profilerResults);</span>
            
<span class="fc" id="L363">            write(&quot;\n\n###################################################&quot;, profilerResults);</span>
<span class="fc" id="L364">            write(&quot;\n#########GENERATION phase profiler results#########&quot;, profilerResults);</span>
<span class="fc" id="L365">            writeAverages(generateAverages, profilerResults);</span>
<span class="fc" id="L366">            write(&quot;\n###################################################&quot;, profilerResults);</span>
            
<span class="fc" id="L368">            write(&quot;\n\n#######################################################&quot;, profilerResults);</span>
<span class="fc" id="L369">            write(&quot;\n#########TRANSFORMATION phase profiler results#########&quot;, profilerResults);</span>
<span class="fc" id="L370">            writeAverages(transformAverages, profilerResults);</span>
<span class="fc" id="L371">            write(&quot;\n#######################################################&quot;, profilerResults);</span>
                        
<span class="fc" id="L373">            JSXMFacade.getInstance().setPDFReportRequirements( pdfReportFlag,  projectName);</span>
            
<span class="fc" id="L375">            String profilerTxt = jsxmSpecRootDir + &quot;jsxmLogs/general-Log/profiler.txt&quot;;</span>
<span class="fc" id="L376">            Various.writeToFileOptions(profilerTxt, profilerResults.toString(), true, false);</span>
              
<span class="fc" id="L378">            JSXMUtils.readTxtWriteToPdf(new File(profilerTxt).getAbsolutePath(), jsxmSpecRootDir + &quot;jsxmLogs/general-Log/profiler.pdf&quot;, &quot;profiler&quot;);</span>
<span class="fc" id="L379">        } else {</span>
<span class="nc" id="L380">            logger.info(&quot;Profiler can not run with executions set to 1 and lower.&quot;);</span>
<span class="nc" id="L381">            logger.info(&quot;Change the tag  &lt;executions&gt;&lt;/executions&gt; to the pom.xml&quot;);</span>
        }
        
<span class="fc" id="L384">    }</span>
    
    /**
     * Write.
     * 
     * @param s
     *            the s
     * @param contents
     *            the contents
     */
    private void write(String s, StringBuilder contents) {
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">        for (int i = 0; i &lt; indent; i++) {</span>
<span class="nc" id="L396">            contents.append(&quot;    &quot;);</span>
        }
<span class="fc" id="L398">        contents.append(s);</span>
<span class="fc" id="L399">    }</span>
    
    /**
     * Write averages.
     * 
     * @param averages
     *            the averages
     * @param profilerResults
     *            the profiler results
     */
    private void writeAverages(long averages[], StringBuilder profilerResults) {
<span class="fc" id="L410">        final String averageTime=&quot;\nAverage Processing Time of &quot;;</span>
<span class="fc" id="L411">        final String timeMeasure=&quot; ms&quot;;</span>
<span class="fc" id="L412">        final String executionsString=executions + &quot; executions : &quot;;</span>
<span class="fc" id="L413">        write(&quot;\nMultithreading with newFixedThreadPool with all available processors&quot;, profilerResults);</span>
<span class="fc" id="L414">        write(averageTime+ executionsString + averages[MULTI_FIXED_POOL] +timeMeasure, profilerResults);</span>
        
<span class="fc" id="L416">        write(&quot;\n\nMultithreading with newCachedThreadPool&quot;, profilerResults);</span>
<span class="fc" id="L417">        write(averageTime + executionsString+ averages[MULTI_CACHED_POOL] + timeMeasure, profilerResults);</span>
        
<span class="fc" id="L419">        write(&quot;\n\nSingle threading with newSingleThreadExecutor &quot;, profilerResults);</span>
<span class="fc" id="L420">        write(averageTime + executionsString + averages[SINGLE_SINGLE_POOL] + timeMeasure, profilerResults);</span>
        
<span class="fc" id="L422">        write(&quot;\n\nSingle threading with newFixedThreadPool with capacity of 1 thread&quot;, profilerResults);</span>
<span class="fc" id="L423">        write(averageTime + executionsString + averages[SINGLE_FIXED_POOL] + timeMeasure, profilerResults);</span>
<span class="fc" id="L424">        long min = averages[MULTI_FIXED_POOL];</span>
<span class="fc bfc" id="L425" title="All 2 branches covered.">        for (int i = 0; i &lt; averages.length; i++) {</span>
<span class="fc bfc" id="L426" title="All 2 branches covered.">            if (averages[i] &lt; min) {</span>
<span class="fc" id="L427">                min = averages[i];</span>
            }
        }
<span class="fc" id="L430">    }</span>
    
    /**
     * Profile validation.
     * 
     * @param multiThreaded
     *            the multi threaded
     * @param singleThreadImplementation
     *            the single thread implementation
     * @param multiThreadImplementation
     *            the multi thread implementation
     * @return the long
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     */
    private long profileValidation(String threadPoolExecutor) throws MojoExecutionException, MojoFailureException {
<span class="fc" id="L448">        long[] totalExecutions = new long[executions];        </span>
<span class="fc" id="L449">        JSXMBenchMark.getInstance().setThreads(threads);</span>
<span class="fc" id="L450">        JSXMBenchMark.getInstance().setConsoleLoggerLevel(consoleLoggerLevel);</span>
<span class="fc" id="L451">        JSXMBenchMark.getInstance().setHtmlFileLoggerLevel(htmlFileLoggerLevel);</span>
<span class="fc" id="L452">        JSXMBenchMark.getInstance().setTxtFileLoggerLevel(txtFileLoggerLevel);</span>
<span class="fc" id="L453">        JSXMBenchMark.getInstance().setAnsiSupport(ansiSupport);</span>
<span class="fc" id="L454">        JSXMBenchMark.getInstance().setNameSpace(nameSpace);</span>
<span class="fc" id="L455">        JSXMBenchMark.getInstance().setJsxmSpecRootDir(jsxmSpecRootDir);</span>
<span class="fc" id="L456">        JSXMBenchMark.getInstance().setTestDirectory(testDirectory);</span>
<span class="fc" id="L457">        JSXMBenchMark.getInstance().validationBenchMark(threadPoolExecutor,totalExecutions,executions);</span>
<span class="fc" id="L458">        return calculateAverage(totalExecutions);</span>
    }
   
    
    /**
     * Compile.
     * 
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     */
    private void compile() throws MojoExecutionException, MojoFailureException {
<span class="fc" id="L471">        JSXMFacade.getInstance().compileSpecification(m2Home, tempTarget, testDirectory, javaDirectory,</span>
                jsxmSpecRootDir, mode, kInput, jsxmSxmImports, jsxmSxmBaseImports, jsxmSxmBaseInheritance, kList);
<span class="fc" id="L473">        JSXMFacade.getInstance().compileSxmGeneratedFiles(tempTarget);</span>
<span class="fc" id="L474">    }</span>
    
    /**
     * Profile compilation.
     * 
     * @param multiThreaded
     *            the multi threaded
     * @param singleThreadImplementation
     *            the single thread implementation
     * @param multiThreadImplementation
     *            the multi thread implementation
     * @return the long
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     */
    private long profileCompilation(String threadPoolExecutor) throws MojoExecutionException, MojoFailureException, IOException {
<span class="fc" id="L494">        long[] totalExecutions = new long[executions];</span>
<span class="fc" id="L495">        File specXML = new File(tempTarget+fileSeparator+&quot;temp&quot;);</span>
<span class="fc" id="L496">        JSXMBenchMark.getInstance().validationBenchMark(threadPoolExecutor,totalExecutions,executions);</span>
<span class="fc bfc" id="L497" title="All 2 branches covered.">        for (int i = 0; i &lt; executions; i++) {</span>
<span class="fc" id="L498">            long compilePhaseStart = System.currentTimeMillis();</span>
<span class="fc" id="L499">            compile();</span>
<span class="fc" id="L500">            long compilePhaseEnd = System.currentTimeMillis();</span>
<span class="fc" id="L501">            long compilePhase = compilePhaseEnd - compilePhaseStart;</span>
<span class="fc" id="L502">            logger.debug(&quot;&quot; + compilePhase);</span>
<span class="fc" id="L503">            totalExecutions[i] = compilePhase;</span>
<span class="fc" id="L504">            FileUtils.deleteDirectory(specXML);</span>
        }
<span class="fc" id="L506">        return calculateAverage(totalExecutions);</span>
    }
    
    /**
     * Generate.
     * 
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     */
    private void generate() throws MojoExecutionException, MojoFailureException {
<span class="fc" id="L518">        JSXMFacade.getInstance().generateTests();</span>
<span class="fc" id="L519">    }</span>
    
    /**
     * Profile generation.
     * 
     * @param multiThreaded
     *            the multi threaded
     * @param singleThreadImplementation
     *            the single thread implementation
     * @param multiThreadImplementation
     *            the multi thread implementation
     * @return the long
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     */
    private long profileGeneration(String threadPoolExecutor) throws MojoExecutionException, MojoFailureException, IOException {
<span class="fc" id="L539">        File specXML = new File(tempTarget+fileSeparator+&quot;temp&quot;);</span>
<span class="fc" id="L540">        long[] totalExecutions = new long[executions];</span>
<span class="fc" id="L541">        JSXMBenchMark.getInstance().validationBenchMark(threadPoolExecutor,totalExecutions,executions);</span>
<span class="fc bfc" id="L542" title="All 2 branches covered.">        for (int i = 0; i &lt; executions; i++) {</span>
<span class="fc" id="L543">            compile();</span>
<span class="fc" id="L544">            long generatePhaseStart = System.currentTimeMillis();</span>
<span class="fc" id="L545">            generate();</span>
<span class="fc" id="L546">            long generatePhaseEnd = System.currentTimeMillis();</span>
<span class="fc" id="L547">            long generatePhase = generatePhaseEnd - generatePhaseStart;</span>
<span class="fc" id="L548">            logger.debug(&quot;&quot; + generatePhase);</span>
<span class="fc" id="L549">            totalExecutions[i] = generatePhase;</span>
<span class="fc" id="L550">            FileUtils.deleteDirectory(specXML);</span>
        }
<span class="fc" id="L552">        return calculateAverage(totalExecutions);</span>
    }
    
    /**
     * Transofrm.
     * 
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     */
    private void transofrm() throws MojoExecutionException, MojoFailureException {
<span class="fc" id="L564">        JSXMFacade.getInstance().transformTests();</span>
<span class="fc" id="L565">    }</span>
    
    /**
     * Profile thransformation.
     * 
     * @param multiThreaded
     *            the multi threaded
     * @param singleThreadImplementation
     *            the single thread implementation
     * @param multiThreadImplementation
     *            the multi thread implementation
     * @return the long
     * @throws MojoExecutionException
     *             the mojo execution exception
     * @throws MojoFailureException
     *             the mojo failure exception
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     */
    private long profileThransformation(String threadPoolExecutor) throws MojoExecutionException, MojoFailureException, IOException {
<span class="fc" id="L585">        File specXML = new File(tempTarget+fileSeparator+&quot;temp&quot;);</span>
<span class="fc" id="L586">        long[] totalExecutions = new long[executions];</span>
<span class="fc" id="L587">        JSXMBenchMark.getInstance().validationBenchMark(threadPoolExecutor,totalExecutions,executions);</span>
<span class="fc bfc" id="L588" title="All 2 branches covered.">        for (int i = 0; i &lt; executions; i++) {</span>
<span class="fc" id="L589">            compile();</span>
<span class="fc" id="L590">            generate();</span>
<span class="fc" id="L591">            long transformPhaseStart = System.currentTimeMillis();</span>
<span class="fc" id="L592">            transofrm();</span>
<span class="fc" id="L593">            long transformPhaseEnd = System.currentTimeMillis();</span>
<span class="fc" id="L594">            long transformPhase = transformPhaseEnd - transformPhaseStart;</span>
<span class="fc" id="L595">            logger.debug(&quot;&quot; + transformPhase);</span>
<span class="fc" id="L596">            totalExecutions[i] = transformPhase;</span>
<span class="fc" id="L597">            FileUtils.deleteDirectory(specXML);</span>
        }
<span class="fc" id="L599">        return calculateAverage(totalExecutions);</span>
    }
    
    /**
     * Calculate average.
     * 
     * @param totalExecutions
     *            the total executions
     * @return the average
     */
    private long calculateAverage(long[] totalExecutions) {
<span class="fc" id="L610">        long sum = 0;</span>
<span class="fc bfc" id="L611" title="All 2 branches covered.">        for (int i = 0; i &lt; totalExecutions.length; i++) {</span>
<span class="fc" id="L612">            sum += totalExecutions[i];</span>
        }
<span class="fc" id="L614">        logger.debug(&quot;&quot; + sum);</span>
<span class="pc bpc" id="L615" title="1 of 2 branches missed.">        if (totalExecutions.length &gt; 0) {</span>
<span class="fc" id="L616">            return sum / totalExecutions.length;</span>
        }
<span class="nc" id="L618">        return 0;</span>
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>