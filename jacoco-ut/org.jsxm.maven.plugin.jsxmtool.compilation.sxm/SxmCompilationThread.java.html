<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SxmCompilationThread.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jsxm-maven-plugin</a> &gt; <a href="index.html" class="el_package">org.jsxm.maven.plugin.jsxmtool.compilation.sxm</a> &gt; <span class="el_source">SxmCompilationThread.java</span></div><h1>SxmCompilationThread.java</h1><pre class="source lang-java linenums">/**
 * JSXM Maven PLugin CONFIDENTIAL
 * 
 *  __________________
 * 
 * Unpublished Copyright Â© 2012-2013 Konstantinos Margaritis, 
 * All Rights Reserved.
 * 
 * NOTICE:  All information contained herein is, and remains the property of Konstantinos Margaritis . 
 *
 * The intellectual and technical concepts contained herein are proprietary to the owner
 * Konstantinos Margaritis and may be covered by U.S and Foreign Patents, patents in process, 
 * and are protected by trade secret or copyright law. Dissemination of this information or 
 * reproduction of this material is strictly forbidden unless prior written permission is
 * obtained from Konstantinos Margaritis. Access to the source code contained herein is hereby 
 * forbidden to anyone except the owner.Confidentiality and Non-disclosure agreements 
 * explicitly covering such access.
 *
 * The copyright notice above does not evidence any actual or intended publication 
 * or disclosure  of  this source code, which includes information that is confidential 
 * and/or proprietary, and is a trade secret, of  Konstantinos Margaritis. ANY REPRODUCTION, 
 * MODIFICATION, DISTRIBUTION, PUBLIC  PERFORMANCE, OR PUBLIC DISPLAY OF OR THROUGH USE  OF 
 * THIS  SOURCE CODE  WITHOUT  THE EXPRESS WRITTEN CONSENT OF Konstantinos Margaritis IS STRICTLY PROHIBITED, 
 * AND IN VIOLATION OF APPLICABLE LAWS AND INTERNATIONAL TREATIES.  THE RECEIPT OR POSSESSION OF  
 * THIS SOURCE CODE AND/OR RELATED INFORMATION DOES NOT CONVEY OR IMPLY ANY RIGHTS  
 * TO REPRODUCE, DISCLOSE OR DISTRIBUTE ITS CONTENTS, OR TO MANUFACTURE, USE, OR SELL 
 * ANYTHING THAT IT  MAY DESCRIBE, IN WHOLE OR IN PART.  
 * 
 */
package org.jsxm.maven.plugin.jsxmtool.compilation.sxm;

import java.io.File;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.List;
import java.util.Properties;

import org.jsxm.maven.plugin.jsxmtool.core.JSXM;
import org.jsxm.maven.plugin.jsxmtool.core.Specification;
import org.jsxm.maven.plugin.jsxmtool.utilities.SxmCompilationUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.slf4j.MDC;

/**
 * @author Konstantinos Margaritis
 * 
 */
public class SxmCompilationThread implements Runnable {
    
<span class="fc" id="L51">    private final Logger logger = (Logger) LoggerFactory.getLogger(this.getClass());</span>
<span class="fc" id="L52">    private static final Object CONSTRUCTOR_LOCK = new Object();</span>
<span class="fc" id="L53">    private static final Object GENERATED_XSD_LOCK = new Object();</span>
    
    private String jsxmSpecRootDir;
    private String m2Home;
    private String tempTarget;
    private String testDirectory;
    private String mode;
    private String kInput;
    private String sxmBaseImports;
    private String sxmImports;
    private String sxmBaseInheritance;
    private File javaDirectory;
    private Properties kList;
    private File tempSpec;
    private List&lt;File&gt; javaFiles;
    
    /**
     * Instantiates a new sxm compilation thread.
     * 
     */
    public SxmCompilationThread() {
<span class="fc" id="L74">        super();</span>
<span class="fc" id="L75">    }</span>
    
    @Override
    public void run() {
<span class="fc" id="L79">        MDC.put(&quot;specificationName&quot;,</span>
                SxmCompilationUtils.extractSourceClass(tempSpec.getName(), JSXM.SPECIFICATION_EXTENSION_LENGTH));
<span class="fc" id="L81">        logger.debug(&quot;Specification directory: &quot; + tempSpec.getParentFile().getAbsolutePath());</span>
        SxmCompiler sxmCompiler;
        Specification p;
<span class="fc" id="L84">        synchronized (CONSTRUCTOR_LOCK) {</span>
<span class="fc" id="L85">            sxmCompiler = new SxmCompiler(jsxmSpecRootDir, m2Home, tempTarget, testDirectory, mode, kInput,</span>
                    sxmBaseImports, sxmImports, sxmBaseInheritance, kList, tempSpec, javaFiles);
<span class="fc" id="L87">            logger.debug(&quot;The sxm compiler object &quot; + sxmCompiler);</span>
<span class="fc" id="L88">            p = sxmCompiler.setSpecification();</span>
<span class="fc" id="L89">            JSXM.getInstance().addSpecification(p);</span>
<span class="fc" id="L90">            logger.debug(&quot;Adding &quot; + p.getClassName());</span>
<span class="fc" id="L91">            logger.debug(&quot;The specfication list lenght is:  &quot; + JSXM.getInstance().getSpecificationList().size());</span>
<span class="pc" id="L92">        }</span>
<span class="fc" id="L93">        File sxm = new File(p.getTempDirectory() + p.getClassName() + &quot;SXM.java&quot;);</span>
<span class="fc" id="L94">        File sxmBase = new File(p.getTempDirectory() + p.getClassName() + &quot;SXM_base.java&quot;);</span>
        
<span class="fc" id="L96">        SimpleDateFormat sdf = new SimpleDateFormat(&quot;MM/dd/yyyy HH:mm:ss&quot;);</span>
<span class="fc" id="L97">        logger.debug(&quot;Jsxm model was last modified at :&quot; + tempSpec.toString() + &quot; &quot;</span>
                + sdf.format(tempSpec.lastModified()));
<span class="fc" id="L99">        logger.debug(&quot;SXM java file was last modified at :&quot; + sxm.toString() + &quot; &quot; + sdf.format(sxm.lastModified()));</span>
<span class="fc" id="L100">        logger.debug(&quot;SXMBase java file was last modified at :&quot; + sxmBase.toString() + &quot; &quot;</span>
                + sdf.format(sxmBase.lastModified()));
        
<span class="pc bpc" id="L103" title="1 of 4 branches missed.">        if ((sxm.exists()) &amp;&amp; (sxmBase.exists())) {</span>
<span class="pc bpc" id="L104" title="2 of 4 branches missed.">            if (tempSpec.lastModified() &lt; sxm.lastModified() &amp;&amp; tempSpec.lastModified() &lt; sxmBase.lastModified()) {</span>
<span class="fc" id="L105">                logger.info(&quot;Nothing to compile - all classes are up to date&quot; + &quot;(&quot; + p.getClassName() + &quot;)&quot;);</span>
            } else {
<span class="nc" id="L107">                compile(sxmCompiler, p);</span>
            }
        } else {
<span class="fc" id="L110">            compile(sxmCompiler, p);</span>
        }
<span class="fc" id="L112">        MDC.remove(&quot;specificationName&quot;);</span>
<span class="fc" id="L113">    }</span>
    
    /**
     * Compile.
     * 
     * @param sxmCompiler
     *            the sxm compiler
     * @param p
     *            the p
     */
    private void compile(SxmCompiler sxmCompiler, Specification p) {
<span class="fc" id="L124">        synchronized (GENERATED_XSD_LOCK) {</span>
            try {
<span class="fc" id="L126">                boolean compileGenerated = false;</span>
                
<span class="fc" id="L128">                compileGenerated = SxmCompilationUtils.generatJavaFromXSD(p.getParentDirectory(), p.getXjcDirectory(),</span>
                        javaDirectory.getAbsolutePath());
<span class="fc" id="L130">                p.setCompileGeneratedJava(compileGenerated);</span>
                
<span class="nc" id="L132">            } catch (IOException e) {</span>
<span class="nc" id="L133">                logger.error(&quot;IOException : &quot;, e);</span>
<span class="fc" id="L134">            }</span>
            
<span class="fc" id="L136">            sxmCompiler.preCompile(p.isCompileGeneratedJava(), p.getXjcGeneratedDirectory(), p.getTempDirectory(),</span>
                    p.getDependentDirectory());
<span class="pc" id="L138">        }</span>
<span class="fc" id="L139">        sxmCompiler.setParameters(p.getMode(), p.getSpecificationPath(), p.getTempDirectory(), p.getJsxmJarPath(),</span>
                p.getSpecificationDirectory());
        
<span class="fc" id="L142">        sxmCompiler.compileSXMBase(p.getTempDirectory(), p.getClassName(), p.getSpecificationFile());</span>
<span class="fc" id="L143">    }</span>
    
    public String getJsxmSpecRootDir() {
<span class="nc" id="L146">        return jsxmSpecRootDir;</span>
    }
    
    public void setJsxmSpecRootDir(String jsxmSpecRootDir) {
<span class="fc" id="L150">        this.jsxmSpecRootDir = jsxmSpecRootDir;</span>
<span class="fc" id="L151">    }</span>
    
    public String getM2Home() {
<span class="nc" id="L154">        return m2Home;</span>
    }
    
    public void setM2Home(String m2Home) {
<span class="fc" id="L158">        this.m2Home = m2Home;</span>
<span class="fc" id="L159">    }</span>
    
    public String getTempTarget() {
<span class="nc" id="L162">        return tempTarget;</span>
    }
    
    public void setTempTarget(String tempTarget) {
<span class="fc" id="L166">        this.tempTarget = tempTarget;</span>
<span class="fc" id="L167">    }</span>
    
    public String getTestDirectory() {
<span class="nc" id="L170">        return testDirectory;</span>
    }
    
    public void setTestDirectory(String testDirectory) {
<span class="fc" id="L174">        this.testDirectory = testDirectory;</span>
<span class="fc" id="L175">    }</span>
    
    public String getMode() {
<span class="nc" id="L178">        return mode;</span>
    }
    
    public void setMode(String mode) {
<span class="fc" id="L182">        this.mode = mode;</span>
<span class="fc" id="L183">    }</span>
    
    public String getkInput() {
<span class="nc" id="L186">        return kInput;</span>
    }
    
    public void setkInput(String kInput) {
<span class="fc" id="L190">        this.kInput = kInput;</span>
<span class="fc" id="L191">    }</span>
    
    public String getSxmBaseImports() {
<span class="nc" id="L194">        return sxmBaseImports;</span>
    }
    
    public void setSxmBaseImports(String sxmBaseImports) {
<span class="fc" id="L198">        this.sxmBaseImports = sxmBaseImports;</span>
<span class="fc" id="L199">    }</span>
    
    public String getSxmImports() {
<span class="nc" id="L202">        return sxmImports;</span>
    }
    
    public void setSxmImports(String sxmImports) {
<span class="fc" id="L206">        this.sxmImports = sxmImports;</span>
<span class="fc" id="L207">    }</span>
    
    public String getSxmBaseInheritance() {
<span class="nc" id="L210">        return sxmBaseInheritance;</span>
    }
    
    public void setSxmBaseInheritance(String sxmBaseInheritance) {
<span class="fc" id="L214">        this.sxmBaseInheritance = sxmBaseInheritance;</span>
<span class="fc" id="L215">    }</span>
    
    public File getJavaDirectory() {
<span class="nc" id="L218">        return javaDirectory;</span>
    }
    
    public void setJavaDirectory(File javaDirectory) {
<span class="fc" id="L222">        this.javaDirectory = javaDirectory;</span>
<span class="fc" id="L223">    }</span>
    
    public Properties getkList() {
<span class="nc" id="L226">        return kList;</span>
    }
    
    public void setkList(Properties kList) {
<span class="fc" id="L230">        this.kList = kList;</span>
<span class="fc" id="L231">    }</span>
    
    public File getTempSpec() {
<span class="nc" id="L234">        return tempSpec;</span>
    }
    
    public void setTempSpec(File tempSpec) {
<span class="fc" id="L238">        this.tempSpec = tempSpec;</span>
<span class="fc" id="L239">    }</span>
    
    public List&lt;File&gt; getJavaFiles() {
<span class="nc" id="L242">        return javaFiles;</span>
    }
    
    public void setJavaFiles(List&lt;File&gt; javaFiles) {
<span class="fc" id="L246">        this.javaFiles = javaFiles;</span>
<span class="fc" id="L247">    }</span>
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>